<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>天下行</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" href="/public/phone/lb/css/bootstrap.min.css">
		<link rel="stylesheet" href="/public/phone/lb/css/swiper.min.css">
		<link rel="stylesheet" href="/public/phone/css/reset.css">
		<link rel="stylesheet" href="/public/phone/css/public.css">
		<link rel="stylesheet" href="/public/phone/css/index.css">
		<script src="/public/phone/lb/js/jquery.min.js"></script>
		<script src="/public/phone/js/masonry-docs.min.js"></script>
		<script src="/public/phone/lb/js/bootstrap.min.js"></script>
		<script src="/public/phone/lb/js/swiper.min.js"></script>
		<script src="/public/phone/js/rem.js"></script>
		<link rel="stylesheet" href="/public/phone/css/style.css">
		<script src="/public/phone/js/iscroll.js"></script>
		<style type="text/css">
			.tit p{
				margin-top: 5px;
			}
			.lpk_foot ul li{
				width: 20%;
			}
		</style>
	</head>

	<body>

		<header class="lpk_head clearfix">
			<div class="fl left">
				<!-- <a onclick="javascript :history.back(-1);">
					<font class="glyphicon glyphicon-menu-left"></font>
				</a> -->
			</div>
			<div class="fl center">
				图文
			</div>
			<div class="fr right">
			</div>
		</header>
		<div class="" style="width: 100%;height: 1.5rem;"> </div>

		<div id="wrapper" style="top: 1.5rem;bottom: 1.5rem;" data-flag='true'>
			<div id="scroller" class="index-prolist content index-prolist1">
				<section id="root" class="clearfix">

				</section>
				<div class="pull-loading">
					上拉加载
				</div>
			</div>
		</div>
		

		<script>
			var search = "{$search}";
			$(function() {
				var id = 0;
				if(location.href.indexOf("?")!=-1)
				{
					var lpkData = location.href.split("?")[1];
					id = lpkData.split("=")[1];
				}
				
				pullOnLoad(id);

			})

			$('#root').on('click', '.box a', function() {
				var id = $(this).attr('id');
				console.log(id);
				window.location.href = `ProductShow.html?id=${id}`;

			})

			var myscroll = new iScroll("wrapper", {
				onScrollMove: function() { //拉动时
					//上拉加载
					if(this.y < this.maxScrollY) {
						$(".pull-loading").html("释放加载");
						$(".pull-loading").addClass("loading");
					} else {
						$(".pull-loading").html("上拉加载");
						$(".pull-loading").removeClass("loading");
					}
				},
				onScrollEnd: function() { //拉动结束时
					//上拉加载
					if($(".pull-loading").hasClass('loading')) {
						$(".pull-loading").html("加载中...");
						pullOnLoad();
					}
				},
				onRefresh: function() {
					$('.pull-loading').html("上拉加载");
				}
			});
			//上拉加载函数,ajax
			var num = 0;
			var page = 6; //每次加载4条
			var lpk = 1;

			function pullOnLoad(fn) {
				
				var stu=$('#wrapper').attr('data-flag');
				if(stu==false){
					return;
				}
				$('#wrapper').attr('data-flag','false');
				var ids = fn;
				setTimeout(function() {

					$.ajax({
						url: '/app.php/Product/getData',
						type: "get",
						dataType: 'json',
						data: {
							CurrentPage: lpk,
							paginalNum: page,
							sort_id: ids,
							search: search
						},
						success: function(data) {
							
							if(data.code==200){
								console.log(data)
								var result = "";
								var dataArr = data.data;
								if(dataArr.length >0) {
									for(var i = num; i < dataArr.length; i++) {
										result += `
										<div class="box">
											<a href="http://jinshang.rjsjzx.com/Product/tuwen_show.html" >
											    <div class="img-box">
												<img class="itemImg" src="/public/upload/Product/51bb5d152806881bb54f893385fb96b2.jpg">
												</div>
												<div class="tit">
													<p>图文名称</p>
									 			</div>
											</a>
										</div>`
								
									}
									$("#scroller section").append(result);
									lpk++;
									myscroll.refresh();
								}else {
									$(".pull-loading").text("无数据");
								}
								$('#wrapper').attr('data-flag','true');
							}
						},
						error: function() {
							console.log("出错了");
						}
					});
					myscroll.refresh();
				}, 1000);
			}
		</script>
	</body>

</html>