<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>会员管理</title>
</head>
<body>
    
    <div id='ProductAttr_toolber' style=" padding:5px 0px 5px 5px">
        <div style=" height:5px"></div>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-add'" onclick="add_MallProductAttr()">新增</a>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-add'" onclick="edit_MallProductAttr()">修改</a>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-no'" onclick="del_MallProductAttr()">删除</a>
    </div>
    <table id="MallProductAttr"></table>

    <input type="hidden" id="select_MallProductAttr" style="display:none" />
    <div id="div_add_MallProductAttr" style="display:none;">
        <input type="hidden" id="caozuo_MallProductAttr" value="{$caozuo}" style="display:none"  />
        <div style=" padding:10px 10px;">
            <p style="height:20px; line-height:10px; font-size:14px;">
                属性名称：
                <input id="attr_ProductAttr" class="easyui-textbox" data-options="required: true" style="width:200px;height: 30px;line-height: 30px;">
            </p>
            <p style="height:20px; line-height:30px; font-size:14px;">
                商品模型：
                <input id="attr_ProductModel" style="width:200px;height: 30px;line-height: 30px;">
            </p>
            <p style="height:20px; line-height:30px; font-size:14px;">
                录入方式：
                <input type="radio" name="attr_AttrMode" value="1" checked="true">手工录入 
                <input type="radio" name="attr_AttrMode" value="2">从下面的列表中选择（一行代表一个可选值）
                <input type="radio" name="attr_AttrMode" value="3">多行文本框
            </p>
            <p style="height:80px; line-height:10px; font-size:14px;">可选值列表：
                <input id="attr_AttrValues" class="easyui-textbox" data-options="multiline:true,height:80" style="width:200px;line-height: 30px;">
            </p>
            <div style="text-align: center;">
                <a name="save" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add'">保存</a>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a id="btn_cancel_MallProductSort" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-clear'">取消</a>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(function () {
            $('#MallProductAttr').datagrid({
                url: '__APP__/MallProductAttr/getData',
                columns: [[
                    { field: 'cbo_MallProductAttr', checkbox: true },
                    { field: 'id', title: 'ID', hidden: true },
                    { field: 'attr', title: '属性名称', width: 100 , align: 'center'},
                    { field: 'model', title: '所属模型', width: 100 , align: 'center'},
                    { field: 'mode', title: '输入方式', width: 100 , align: 'center',
                        formatter: function (value, row, index) {
                            var a = "";
                            if(value=="1")
                            {
                                a = "手工录入";
                            }
                            else if(value=="2")
                            {
                                a = "从列表中选择";
                            }
                            else if(value=="3")
                            {
                                a = "多行文本框";
                            }
                            return a;
                        }},
                    { field: 'values', title: '可选值', width: 150 , align: 'center'}
                    //{ field: 'integral', title: '排序', width: 100 , align: 'center'}
                ]],
                //斑马线
                striped: true,
                //底部分页
                pagination: true,
                //行号
                rownumbers: true,
                //只能选中一行
                singleSelect: true,
                //如果为true，单击复选框将永远选择行。如果为false，选择行将不选中复选框。
                selectOnCheck: false,
                //如果为true，当用户点击行的时候该复选框就会被选中或取消选中。如果为false，当用户仅在点击该复选框的时候才会呗选中或取消。
                checkOnSelect: false,
                //工具栏
                toolbar: '#ProductAttr_toolber',
                //是否显示行脚
                showFooter: true,
                idField: 'id'
            });

            $("#attr_ProductModel").combobox({
                url: '__APP__/MallProductModel/getModelList',
                method: 'post',
                valueField: 'id',
                textField: 'text',
                required: true
            })
        })
    </script>

    <script type="text/javascript">
        function add_MallProductAttr() {
            //alert("ok");
            $('#caozuo_MallProductAttr').val("add");
            $('#div_add_MallProductAttr').show();
            $('#div_add_MallProductAttr').window({
                title: '属性添加',
                width: 600,
                height: 300,
                modal: true,
                collapsible: false,
                minimizable: false,
                maximizable: false,
                //closed: true,
                onClose: function () {
                    $("#attr_ProductAttr").textbox('setValue', "");
                    $("#attr_ProductModel").combobox('reload');
                    $("#div_add_MallProductAttr [name='attr_AttrMode']").eq(0).click();
                    $("#attr_AttrValues").textbox('setValue', "");
                }
            });
        }

        function edit_MallProductAttr() {
            var selected = $('#MallProductAttr').datagrid('getSelected');
            $('#select_MallProductAttr').val(selected.id);
            $('#caozuo_MallProductAttr').val("edit");
            $.ajax({
                url: '__APP__/MallProductAttr/info',
                data: { id: selected.id },
                type: 'post',
                dataType: 'json',
                success: function (data) {
                    if (data.status == "idNull") {
                        alert("请选择要修改的数据");
                        return;
                    }
                    else if (data.status == "DataNull") {
                        alert("要修改的数据不存在，请确认");
                        return;
                    }
                    else
                    {
                        $("#attr_ProductAttr").textbox('setValue', data.attr);
                        $("#attr_ProductModel").combobox('setValue', data.model_id);
                        $("#attr_AttrValues").textbox('setValue', data.values);
                    }
                }
            })

            $('#div_add_MallProductAttr').show();
            $('#div_add_MallProductAttr').window({
                title: '属性修改',
                width: 400,
                height: 420,
                modal: true,
                collapsible: false,
                minimizable: false,
                maximizable: false,
                //closed: true,
                onClose: function () {
                    $("#attr_ProductAttr").textbox('setValue', "");
                    $("#attr_ProductModel").combobox('reload');
                    $("#div_add_MallProductAttr [name='attr_AttrMode']").eq(0).click();
                    $("#attr_AttrValues").textbox('setValue', "");
                }
            });
        }

        function del_MallProductAttr() {
            var checked = $('#MallProductAttr').datagrid('getChecked');
            var delID = "";
            if (checked.length > 0) {
                $.messager.confirm('确认', '您确认要删除这些数据吗？', function (r) {
                    if (r) {
                        for (var i = 0; i < checked.length; i++) {
                            delID += checked[i].id;
                            delID += ",";
                        }
                        delID = delID.substr(0, delID.length - 1);

                        $.ajax({
                            url: '__APP__/MallProductAttr/delete',
                            data: { id: delID },
                            type: 'post',
                            success: function (msg) {
                                if (msg == "ok") {
                                    alert("删除成功");
                                    $('#MallProductAttr').datagrid('reload');
                                }
                                if (msg == "error") {
                                    alert("删除失败，请重新尝试");
                                }
                                if (msg == "no") {
                                    alert("数据不存在，刷新后请重新操作");
                                }
                            }
                        })
                    }
                })
            }
            else {
                alert("请选择要删除的数据");
            }
        }
        
        // function caozuo_sequence_sort(item){
        //     var name = $('#caozuo_field_productsort').val();
        //     var id = $('#caozuo_id_productsort').val();
        //     var value = "";
        //     if(item.text=="置顶")
        //     {
        //         value = "0";
        //     }
        //     else if(item.text=="上移")
        //     {
        //         value = "1";
        //     }
        //     else if(item.text=="下移")
        //     {
        //         value = "2";
        //     }
        //     else if(item.text=="底部")
        //     {
        //         value = "3";
        //     }
        //     $.ajax({
        //         url:'__APP__/MallProductSort/sequence',
        //         data:{"id":id,"name":name,"value":value},
        //         type:'post',
        //         success:function(msg){
        //             if(msg=="ok")
        //             {
        //                 layer.msg("操作成功");
        //                 $('#MallProductSort').treegrid('reload');
        //                 return;
        //             }
        //             if(msg=="error")
        //             {
        //                 layer.msg("操作失败，请重新操作");
        //                 return;
        //             }
        //             if(msg=="id_null")
        //             {
        //                 layer.msg("请选择要操作的数据");
        //                 return;
        //             }
        //         }
        //     })
        // }
    </script>
    <script type="text/javascript">
        $(function () {
            $('#div_add_MallProductAttr [name="save"]').click(function () {
                var caozuo = $('#caozuo_MallProductAttr').val();
                var attr = $("#attr_ProductAttr").textbox('getValue');
                console.log(attr);
                var model = $("#attr_ProductModel").combobox('getValue');
                console.log(model);
                var mode = $("#div_add_MallProductAttr [name='attr_AttrMode']:checked").val();
                console.log(mode);
                var values = $("#attr_AttrValues").textbox('getValue');
                console.log(values);
                $.ajax({
                    url: '__APP__/MallProductAttr/' + caozuo,
                    data: { id: $('#select_MallProductAttr').val(), attr: attr, model: model, mode: mode, values: values },
                    type: 'post',
                    success: function (msg) {
                        if (msg == "ok") {
                            layer.msg("保存成功",{time:2000},function(){
                                $('#div_add_MallProductAttr').window('close');
                                $('#MallProductAttr').datagrid('reload');
                            });
                        }
                        else if(msg=="id_null")
                        {
                            layer.msg("请选择要修改的分类");
                        }
                        else if (msg == "name_null")
                        {
                            layer.msg("请输入分类名称");
                        }
                        else if (msg == "model_null")
                        {
                            layer.msg("请选择该属性所属的模型");
                        }
                    }
                })
            })

            $('#btn_cancel_MallProductAttr').click(function () {
                $('#div_add_MallProductAttr').window('close');
            })
        })
    </script>
</body>
</html>
