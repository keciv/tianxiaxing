<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
</head>
<body>
    <div id='withdrawal_toolber' style=" padding:5px 0px 5px 5px">
        <input id="withdrawal_search" />
        <div id="search_withdrawal_tiaojian" style="width:120px">
            <div data-options="name:'phone',iconCls:'icon-ok'">手机号</div>
            <!-- <div data-options="name:'username',iconCls:'icon-ok'">用户名</div> -->
            <div data-options="name:'username',iconCls:'icon-ok'">用户名</div>
        </div>

        <div style=" height:5px"></div>
<!--         <a class="easyui-linkbutton" data-options="iconCls:'icon-add'" id="add_member">新增</a>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-edit'" id="edit_member">修改</a>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-no'" id="delete_member">删除</a> -->
        <a class="easyui-linkbutton" data-options="iconCls:'icon-no'" id="delete_withdrawal">删除</a>
    </div>

    <table id='MemberWithdrawal'></table>
    <div id="caozuo_status" class="easyui-menu" data-options="onClick:caozuo_status" style="width:120px;">
        <div>已处理</div>
    </div>
    <input type="hidden" id="caozuo_field_withdrawal" name="">
    <input type="hidden" id="caozuo_id_withdrawal" name="">
    <script type="text/javascript">
        $(function () {
            $('#MemberWithdrawal').datagrid({
                url: '__APP__/Record/get_withdrawal',
                columns: [[
                    { field: 'cbo_Withdrawal', checkbox: true },
                    { field: 'id', title: 'ID', hidden: true },
                    {
                        field: 'nickname', title: '申请会员', width: 100, align: 'center'
                    },
                    {
                        field: 'phone', title: '手机号', width: 100, align: 'center'
                    },
                    {
                        field: 'create_time', title: '申请时间', width: 150, align: 'center'
                    },
                    {
                        field: 'end_time', title: '处理时间', width: 150, align: 'center'
                    },
                    {
                        field: 'money', title: '申请金额', width: 100, align: 'center'
                    },
                    {
                        field: 'fee', title: '手续费', width: 100, align: 'center'
                    },
                    {
                        field: 'shiji', title: '实付金额', width: 100, align: 'center'
                    },
                    {
                        field: 'alipay', title: '支付宝账户', width: 150, align: 'center'
                    },
                    {
                        field: 'open_bank', title: '开户行', width: 140, align: 'center'
                    },
                    {
                        field: 'bank_card', title: '银行卡号', width: 170, align: 'center'
                    },
                    {
                        field: 'card_owner', title: '持卡人姓名', width: 100, align: 'center'
                    },
                    {
                        field: 'status', title: '状态', width: 100, align: 'center',
                        formatter: function (value, row, index) {
                            var a = "";
                            if(value=="1")
                            {
                                a = "<span style='color:green'>已处理</sapn>";
                            }
                            else
                            {
                                a = "<span style='color:red'>未处理</sapn>";
                            }
                            return a;
                        }
                    }
                ]],
                //斑马线
                striped: true,
                //底部分页
                pagination: true,
                //行号
                rownumbers: true,
                //只能选中一行
                singleSelect: true,
                //如果为true，单击复选框将永远选择行。如果为false，选择行将不选中复选框。
                selectOnCheck: false,
                //如果为true，当用户点击行的时候该复选框就会被选中或取消选中。如果为false，当用户仅在点击该复选框的时候才会呗选中或取消。
                checkOnSelect: false,
                //工具栏
                toolbar: '#withdrawal_toolber',
                //是否显示行脚
                showFooter: true,
                onRowContextMenu:function(e, index, row){
                    e.preventDefault();
                    e.stopPropagation();
                    var pageX = e.pageX;
                    var pageY = e.pageY;
                    var td = $(e.target).closest("td");
                    var field = td.attr('field');
                    if(field=="status")
                    {
                        if(row.status=="0")
                        {
                            $('#caozuo_field_withdrawal').val(field);
                            $('#caozuo_id_withdrawal').val(row.id);
                            $('#caozuo_status').menu('show', {left: pageX,top: pageY});
                        }
                        else{
                            layer.msg("已处理");
                        }
                    }
                }
            });

            $('#withdrawal_search').searchbox({
                searcher: function (value, name) {
                    //alert(value + "," + name)
                    $('#MemberWithdrawal').datagrid('load', {
                        parameterType: name,
                        parameter: value
                    });
                },
                menu: '#search_withdrawal_tiaojian',
                prompt: '请输入值',
                width: 200
            });
        })
        
        function caozuo_status(item){
            var name = $('#caozuo_field_withdrawal').val();
            var id = $('#caozuo_id_withdrawal').val();
            var value = 0;
            if(item.text=="已处理")
            {
                value = 1;
            }
            console.log(value);
            $.ajax({
                url:'__APP__/Record/audit',
                data:{"id":id,"name":name,"value":value},
                type:'post',
                success:function(msg){
                    if(msg=="ok")
                    {
                        layer.msg("操作成功",{time:1500},function(){
                            $('#MemberWithdrawal').datagrid('reload');
                        });
                       
                        return;
                    }
                    if(msg=="error")
                    {
                        layer.msg("操作失败，请重新操作");
                        return; 
                    }
                    if(msg=="id_null")
                    {
                        layer.msg("请选择要操作的数据");
                        return;
                    }
                }
            })
        }

    </script>
    <script type="text/javascript">
        $(function(){
            $('#delete_withdrawal').click(function () {
                var checked = $('#MemberWithdrawal').datagrid('getChecked');
                var delID = "";
                if (checked.length > 0) {
                    $.messager.confirm('确认', '您确认要删除这些数据吗？', function (r) {
                        if (r) {

                            for (var i = 0; i < checked.length; i++) {
                                delID += checked[i].id;
                                delID += ",";
                            }
                            delID = delID.substr(0, delID.length - 1);
                            $.ajax({
                                url: '__APP__/Record/del_withdrawal',
                                data: { "id": delID },
                                type: 'post',
                                success: function (msg) {
                                    if (msg == "ok") {
                                        layer.msg("删除成功",{time:1500},function(){
                                            $('#MemberWithdrawal').datagrid('reload');
                                        })
                                    }
                                    if (msg == "error") {
                                        layer.msg("删除失败，请重新尝试");
                                        alert("");
                                    }
                                    if (msg == "id_null") {
                                        layer.msg("数据不存在，刷新后请重新操作");
                                    }
                                }
                            })
                        }
                    })
                }
                else {
                    alert("请选择要删除的数据");
                }
            })
        })
    </script>
</body>
</html>
