<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
</head>
<body>
    <table id='MallIndexModule'></table>
    <div id='toolbar_MallIndexModule' style=" padding:5px 0px 5px 5px">
        <div style=" height:5px"></div>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-add'" id="add_MallIndexModule">新增</a>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-add'" id="edit_MallIndexModule">修改</a>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-no'" id="delete_MallIndexModule">删除</a>
    </div>
    <div id="caozuo_module_sequence" class="easyui-menu" data-options="onClick:caozuo_module_sequence" style="width:120px;">
        <div>顶端</div>
        <div>上移</div>
        <div>下移</div>
        <div>底部</div>
    </div>
    <input type="hidden" id="caozuo_field_module" name="">
    <input type="hidden" id="caozuo_id_module" name="">
    <script type="text/javascript">
        $('#MallIndexModule').datagrid({
            url: '__APP__/MallIndexModule/getData',
            columns: [[
                { field: 'cbo_Module', checkbox: true },
                { field: 'id', title: 'ID', hidden: true },
                { field: 'module', title: '模块', width: 200, align: 'center' },
                { field: 'description', title: '描述', width: 200, align: 'center' },
                {
                    field: 'picture', title: '图片', width: 200, align: 'center',
                    formatter: function (value, row, index) {
                        var str = "";
                        if (value == "" || value == undefined) {
                            str = '暂无图片';
                        }
                        else {
                            str = '<a><img style="height: 50px;width: 150px;" src="__ROOT__/' + value + '"/></a>';
                        }
                        return str;
                    }
                },
                {
                    field: 'sequence_id', title: '排序', width: 100, align: 'center'
                }
            ]],
            toolbar: '#toolbar_MallIndexModule',
            pagination: true,
            singleSelect: true,
            selectOnCheck: false,
            rownumbers: true,
            idField: 'id',
            checkOnSelect: false,
            onRowContextMenu:function(e, index, row){
                e.preventDefault();
                e.stopPropagation();
                var pageX = e.pageX;
                var pageY = e.pageY;
                var td = $(e.target).closest("td");
                var field = td.attr('field');
                if(field=="sequence_id")
                {
                    $('#caozuo_field_module').val(field);
                    $('#caozuo_id_module').val(row.id);
                    $('#caozuo_module_sequence').menu('show', {left: pageX,top: pageY});
                }
            }
        });
    </script>
    <script type="text/javascript">
        $(function () {
            $('#add_MallIndexModule').click(function () {
                var titleMsg = '添加_首页模块';
                var IsHave = $('#right').tabs('exists', titleMsg);
                if (IsHave) {
                    $('#right').tabs('select', titleMsg);
                    var tab = $('#right').tabs('getSelected');
                    tab.panel('refresh', "__APP__/MallIndexModule/info");
                }
                else {
                    $('#right').tabs('close', "修改_首页模块");
                    $('#right').tabs('add', {
                        title: titleMsg,
                        content: '<div class="easyui-panel" href="__APP__/MallIndexModule/info" fit="true" border="false" ></div>',
                        closable: true
                    });
                }

            })


            $('#edit_MallIndexModule').click(function () {
                var titleMsg = '修改_首页模块';
                var selected = $('#MallIndexModule').datagrid('getSelected');
                if (selected) {
                    var IsHave = $('#right').tabs('exists', titleMsg);
                    if (IsHave) {
                        $('#right').tabs('select', titleMsg);
                        var tab = $('#right').tabs('getSelected');
                        tab.panel('refresh', "__APP__/MallIndexModule/info?id=" + selected.id);
                    }
                    else {
                        $('#right').tabs('close', "添加_首页模块");
                        $('#right').tabs('add', {
                            title: titleMsg,
                            content: '<div class="easyui-panel" href="__APP__/MallIndexModule/info/?id=' + selected.id + '" fit="true" border="false" ></div>',
                            closable: true
                        });
                    }
                }
                else {
                    alert("请选择要进行修改的一条数据");
                }
            })


            $('#delete_MallIndexModule').click(function () {
                var checked = $('#MallIndexModule').datagrid('getChecked');
                var delID = "";
                if (checked.length > 0) {
                    $.messager.confirm('确认', '您确认要删除这些数据吗？', function (r) {
                        if (r) {

                            for (var i = 0; i < checked.length; i++) {
                                delID += checked[i].id;
                                delID += ",";
                            }
                            delID = delID.substr(0, delID.length - 1);
                            $.ajax({
                                url: '__APP__/MallIndexModule/delete',
                                data: { "id": delID },
                                type: 'post',
                                success: function (msg) {
                                    if (msg == "ok") {
                                        alert("删除成功");
                                        $('#MallIndexModule').datagrid('reload');
                                    }
                                    if (msg == "error") {
                                        alert("删除失败，请重新尝试");
                                    }
                                    if (msg == "id_null") {
                                        alert("数据不存在，刷新后请重新操作");
                                    }
                                }
                            })
                        }
                    })
                }
                else {
                    alert("请选择要删除的数据");
                }
            })

        })
        function caozuo_module_sequence(item){
            var name = $('#caozuo_field_module').val();
            var id = $('#caozuo_id_module').val();
            $.ajax({
                url:'__APP__/MallIndexModule/sequence',
                data:{"id":id,"name":name,"value":item.text},
                type:'post',
                success:function(msg){
                    if(msg=="ok")
                    {
                        layer.msg("操作成功");
                        $('#MallIndexModule').datagrid('reload');
                        return;
                    }
                    if(msg=="error")
                    {
                        layer.msg("操作失败，请重新操作");
                        return;
                    }
                    if(msg=="id_null")
                    {
                        layer.msg("请选择要操作的数据");
                        return;
                    }
                }
            })
        }
    </script>
</body>
</html>
